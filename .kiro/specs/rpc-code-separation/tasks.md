# Задачи по разделению RPC генерации

## 1. Создать утилиту определения типа проекта
- Создать класс ProjectTypeDetector с методом DetectProjectType
- Добавить enum ProjectType с значениями Server, Client, Shared, Unknown
- Реализовать логику определения типа по имени сборки
- Добавить тесты для ProjectTypeDetector
- _Требования: 3.1, 3.2, 3.3, 3.4_

## 2. Модифицировать TargetClientRpcGenerator для условной генерации
- Добавить логику определения типа проекта в Execute методе
- Создать switch statement для выбора типа генерации
- Добавить предупреждение для неизвестных типов проектов
- Обновить Initialize метод если необходимо
- _Требования: 1.1, 2.1, 3.1, 3.4_

## 3. Создать метод GenerateServerCode
- Реализовать генерацию только Sender кода
- Использовать namespace KarpikEngineServer.Generated
- Генерировать файл TargetClientRpcSender.g.cs
- Включить методы для TargetRpc и ClientRpc отправки
- Добавить методы SendAll для ClientRpc
- _Требования: 1.1, 1.2, 1.4, 5.1, 6.1_

## 4. Создать метод GenerateClientCode
- Реализовать генерацию только Dispatcher кода
- Использовать namespace KarpikEngineClient.Generated
- Генерировать файл TargetClientRpcDispatcher.g.cs
- Включить switch statement для обработки команд
- Добавить отправку событий в EcsEventWorld
- _Требования: 2.1, 2.2, 2.4, 5.2, 6.2_

## 5. Обновить CommandIdManager для детерминированной генерации ID
- Добавить метод GetDeterministicId
- Реализовать генерацию ID на основе хеша имени команды
- Обеспечить стабильность ID между компиляциями
- Добавить префиксы для TargetRpc и ClientRpc команд
- Обновить существующие методы для совместимости
- _Требования: 4.1, 4.2, 4.3, 4.4_

## 6. Обновить методы поиска команд
- Модифицировать FindAllTargetRpcCommandInfos для использования детерминированных ID
- Модифицировать FindAllClientRpcCommandInfos для использования детерминированных ID
- Обеспечить сортировку команд для стабильности
- Добавить префиксы в ключи CommandIdManager
- _Требования: 4.1, 4.2, 4.3_

## 7. Разделить генерацию файлов
- Обновить GenerateServerCode для создания отдельного файла
- Обновить GenerateClientCode для создания отдельного файла
- Добавить правильные using директивы для каждого проекта
- Добавить комментарии auto-generated в каждый файл
- _Требования: 5.1, 5.2, 5.3, 5.4, 6.3_

## 8. Создать тесты для синхронизации ID
- Написать тест для проверки одинаковых ID в разных проектах
- Создать тест для детерминированной генерации ID
- Добавить тест для стабильности ID между компиляциями
- Проверить отсутствие коллизий ID
- _Требования: 4.2, 4.3_

## 9. Обеспечить обратную совместимость
- Проверить что существующие RPC команды продолжают работать
- Убедиться что API не изменилось
- Добавить возможность отключения старого генератора
- Создать миграционный план
- _Требования: 7.1, 7.2, 7.3, 7.4_

## 10. Обновить документацию
- Обновить RPC_USAGE.md с новой архитектурой
- Добавить примеры разделенного использования
- Документировать процесс определения типа проекта
- Создать руководство по миграции
- _Требования: все_

## 11. Провести интеграционное тестирование
- Протестировать генерацию в серверном проекте
- Протестировать генерацию в клиентском проекте
- Проверить отсутствие генерации в Shared проекте
- Протестировать работу RPC между проектами
- Проверить размеры сборок до и после изменений
- _Требования: все_

## 12. Оптимизация и финализация
- Оптимизировать производительность генерации
- Добавить дополнительные диагностические сообщения
- Провести code review
- Подготовить релизные заметки
- _Требования: все_